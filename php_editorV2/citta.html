<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

   
    <!-- DataTables -->
    <script type="text/javascript" src="editor/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="editor/datatables.min.css"/>


    <link rel="stylesheet" type="text/css" href="editor/DataTables-1.10.23/css/dataTables.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/Editor-1.9.6/css/editor.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/AutoFill-2.3.5/css/autoFill.bootstrap4.min.css"/>
    <link rel="stylesheet" type="text/css" href="editor/Buttons-1.6.5/css/buttons.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/ColReorder-1.5.3/css/colReorder.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/FixedColumns-3.3.2/css/fixedColumns.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/FixedHeader-3.1.7/css/fixedHeader.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/KeyTable-2.5.3/css/keyTable.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/Responsive-2.2.7/css/responsive.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/RowGroup-1.1.2/css/rowGroup.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/RowReorder-1.2.7/css/rowReorder.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/Scroller-2.0.3/css/scroller.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/SearchBuilder-1.0.1/css/searchBuilder.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/SearchPanes-1.2.2/css/searchPanes.bootstrap4.css"/>
    <link rel="stylesheet" type="text/css" href="editor/Select-1.3.1/css/select.bootstrap4.css"/>
    
    <script type="text/javascript" src="editor/jQuery-3.3.1/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="editor/JSZip-2.5.0/jszip.js"></script>
    <script type="text/javascript" src="editor/pdfmake-0.1.36/pdfmake.js"></script>
    <script type="text/javascript" src="editor/pdfmake-0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="editor/DataTables-1.10.23/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="editor/DataTables-1.10.23/js/dataTables.bootstrap4.js"></script>
    <script type="text/javascript" src="editor/Editor-1.9.6/js/dataTables.editor.js"></script>
    <script type="text/javascript" src="editor/Editor-1.9.6/js/editor.bootstrap4.js"></script>
    <script type="text/javascript" src="editor/AutoFill-2.3.5/js/dataTables.autoFill.js"></script>
    <script type="text/javascript" src="editor/AutoFill-2.3.5/js/autoFill.bootstrap4.js"></script>
    <script type="text/javascript" src="editor/Buttons-1.6.5/js/dataTables.buttons.js"></script>
    <script type="text/javascript" src="editor/Buttons-1.6.5/js/buttons.bootstrap4.js"></script>
    <script type="text/javascript" src="editor/Buttons-1.6.5/js/buttons.colVis.js"></script>
    <script type="text/javascript" src="editor/Buttons-1.6.5/js/buttons.html5.js"></script>
    <script type="text/javascript" src="editor/Buttons-1.6.5/js/buttons.print.js"></script>
    <script type="text/javascript" src="editor/ColReorder-1.5.3/js/dataTables.colReorder.js"></script>
    <script type="text/javascript" src="editor/FixedColumns-3.3.2/js/dataTables.fixedColumns.js"></script>
    <script type="text/javascript" src="editor/FixedHeader-3.1.7/js/dataTables.fixedHeader.js"></script>
    <script type="text/javascript" src="editor/KeyTable-2.5.3/js/dataTables.keyTable.js"></script>
    <script type="text/javascript" src="editor/Responsive-2.2.7/js/dataTables.responsive.js"></script>
    <script type="text/javascript" src="editor/RowGroup-1.1.2/js/dataTables.rowGroup.js"></script>
    <script type="text/javascript" src="editor/RowReorder-1.2.7/js/dataTables.rowReorder.js"></script>
    <script type="text/javascript" src="editor/Scroller-2.0.3/js/dataTables.scroller.js"></script>
    <script type="text/javascript" src="editor/SearchBuilder-1.0.1/js/dataTables.searchBuilder.js"></script>
    <script type="text/javascript" src="editor/SearchBuilder-1.0.1/js/searchBuilder.bootstrap4.js"></script>
    <script type="text/javascript" src="editor/SearchPanes-1.2.2/js/dataTables.searchPanes.js"></script>
    <script type="text/javascript" src="editor/SearchPanes-1.2.2/js/searchPanes.bootstrap4.js"></script>
    <script type="text/javascript" src="editor/Select-1.3.1/js/dataTables.select.js"></script>

    <!-- inclusione bootstrap (337/400)-->
    <link rel="stylesheet" href="editor/bootstrap400/css/bootstrap.min.css">
    <script type="text/javascript" src="editor/bootstrap400/js/bootstrap.min.js"></script>

    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css"> -->

    <title>EDITOR v2 - Citta</title>

    <script type="text/javascript" >
	
        var editor; // use a global for the submit and return data rendering in the examples

        $(document).ready(function() {
            editor = new $.fn.dataTable.Editor( {
                ajax: "api/cities.php",
                table: "#cities_table",
                fields: [ 
                    {
                        label: "Nome:",
                        name: "cities.name"
                    }, {
                        label: "Provincia:",
                        name: "cities.province",
                        type: "select"
                    }, {
                        label: "Descrizione:",
                        name: "cities.description"
                    }
                ]
            } );

            // Activate an inline edit on click of a table cell
            $('#cities_table').on( 'click', 'tbody td:not(:first-child)', function (e) {
                editor.inline( this, {
                    onBlur: 'submit'
                });
            });

            $('#cities_table').DataTable( {
                // Opzione DOM (https://datatables.net/reference/option/dom)
                dom: "Blfrtip", // B=button + dom option (l=show entries menu,filtering input,processing,table,info,pagination)
                ajax: {
                    url: "api/cities.php",
                    type: 'POST'
                },
                // imposta il numero dei record mostrati
                lengthMenu: [[10, 25, 50, -1], [10, 25, "Molti", "All"]],
                columns: [
                    // CHECK BOX (per selezionare il campo)
                    {
                        data: null,
                        defaultContent: '',
                        className: 'select-checkbox',
                        orderable: false
                    },
                    { data: "cities.id" },
                    { data: "cities.name"},                    
                    { data: "provinces.name", editField: "cities.province"},
                    { data: "cities.description" }
                    
                ],
                select: true, // permette di selezionare le righe della tabella
                // Aggiunge i bottoni alla tabella (https://datatables.net/extensions/buttons/)
                buttons: [
                    { 
                        extend: "create", 
                        editor: editor , 
                        text: "Nuovo",
                        className: 'btn btn-success',
                        formTitle: "Inserisci Nuova Città",
                        // Imposta dei bottoni customizzati
                        formButtons: [
                            {
                                label: 'Inserisci',
                                className: 'btn btn-primary mr-1 p-1', // m e p classi per margin e padding (non funz)
                                fn: function () { this.submit(); }
                            }
                        ]
                    },
                    { 
                        extend: "edit",   
                        editor: editor , 
                        text: "Modifica",
                        className: 'btn btn-warning',
                        formTitle: "Modifica i dati della Città",
                        // Imposta dei bottoni customizzati
                        formButtons: [
                            {
                                label: 'Conferma',
                                className: 'btn btn-primary',
                                fn: function () { this.submit(); }
                            }
                        ]
                    },
                    {
                        extend: "remove",
                        text: "Elimina",
                        editor: editor,
                        className: 'btn btn-danger',
                        formTitle: "Cancella Città",
                        // Imposta dei bottoni customizzati
                        formButtons: [
                            {
                                label: 'Annulla',
                                className: 'btn btn-info',
                                fn: function () { this.close(); }
                            },
                            {
                                label: 'Conferma',
                                className: 'btn btn-danger',
                                fn: function () { this.submit(); }
                            }
                        ],
                        // Imposta un messaggio custom
                        formMessage: function ( editor, dt ) {
                            var rows = dt.rows( { selected: true } ).data().map( function (rowData) {
                                return rowData.cities.name;
                            } );
                            var retString = 'Sicuro di voler cancellare le seguenti città?<ul>'
                            // cicla gli elementi selezionati nella checkbox (città) => predisposizione per Mjoin
                            $.each(rows, function( index, value ) {
                                retString+='<li><b>'+ value +'</b></li>';
                            });

                            retString+='</ul>';
                            return retString;
                        }
                    }
                ]
            } );
        } );
	</script>
</head>
<body>
    
    <div class="table-responsive mx-auto" style="width:90%;">
        <h1>Tabella Cities (PHP_testdb) - Editor v2</h1>
        <table id="cities_table" class="table table-striped table-bordered display">
            <thead class="thead-dark">
                <tr>
                    <th></th> <!-- checkbox -->
                    <th scope="col">ID</th>
                    <th scope="col">Nome</th>
                    <th scope="col">Provincia</th>
                    <th scope="col">Descrizione</th>
                </tr>
            </thead>
        </table>
        <hr>
        <a href="index.html">Torna alla pagina users</a>
    </div>
</body>
</html>

